# –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π –≤ Portainer

## –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫:
- Portainer Web UI
- Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –∫–æ–¥–æ–º –ø—Ä–æ–µ–∫—Ç–∞
- –°–µ—Ä–≤–µ—Ä —Å Docker –∏ Docker Compose

### 2. –°–æ–∑–¥–∞–Ω–∏–µ Stack –≤ Portainer

1. **–í–æ–π–¥–∏—Ç–µ –≤ Portainer** ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ Environment
2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Stacks** ‚Üí –Ω–∞–∂–º–∏—Ç–µ **"Add stack"**
3. **–ù–∞–∑–≤–∞–Ω–∏–µ**: `gigawin2025`
4. **Build method**: –≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:

#### –í–∞—Ä–∏–∞–Ω—Ç A: Git Repository (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```
Repository URL: <–≤–∞—à git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π>
Reference: main
Compose path: docker-compose.yaml
```

‚úÖ –í–∫–ª—é—á–∏—Ç–µ **"Authentication"**, –µ—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π

#### –í–∞—Ä–∏–∞–Ω—Ç B: Web editor

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `docker-compose.yaml`
2. –í—Å—Ç–∞–≤—å—Ç–µ –≤ Web Editor
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ build paths —É–∫–∞–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### 3. Environment Variables (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

–ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

–ï—Å–ª–∏ –Ω—É–∂–Ω—ã –∫–∞—Å—Ç–æ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```env
FLASK_ENV=production
CORS_ALLOWED_ORIGINS=https://gigawin.unicorns-group.ru,https://10.8.0.17:3017
```

### 4. –î–µ–ø–ª–æ–π

1. –ù–∞–∂–º–∏—Ç–µ **"Deploy the stack"**
2. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (5-10 –º–∏–Ω—É—Ç):
   - ‚úÖ Building images
   - ‚úÖ Creating containers
   - ‚úÖ Starting containers
   - ‚úÖ Health checks

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞

#### –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
–í Portainer –≤—Å–µ 4 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **Running**:
- ‚úÖ `gigawin-nginx` (–∑–µ–ª–µ–Ω—ã–π)
- ‚úÖ `gigawin-backend` (–∑–µ–ª–µ–Ω—ã–π)
- ‚úÖ `gigawin-frontend` (–∑–µ–ª–µ–Ω—ã–π)
- ‚úÖ `gigawin-telegram-bot` (–∑–µ–ª–µ–Ω—ã–π)

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

**–í –±—Ä–∞—É–∑–µ—Ä–µ:**
```
https://gigawin.unicorns-group.ru
https://10.8.0.17:3017
```

**–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:**
```bash
# Health check
curl -k https://gigawin.unicorns-group.ru/health

# API health
curl -k https://gigawin.unicorns-group.ru/api/health

# Frontend
curl -k https://gigawin.unicorns-group.ru/
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: HTTP 200 OK

### 6. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –í Portainer –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
2. –ù–∞–∂–º–∏—Ç–µ **"Logs"**
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
GigaWin2025/
‚îú‚îÄ‚îÄ docker-compose.yaml          # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è Portainer
‚îú‚îÄ‚îÄ Dockerfile.nginx             # Nginx —Å HTTPS
‚îú‚îÄ‚îÄ nginx.conf                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile.ssl           # Backend —Å HTTPS
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile.telegram.standalone
‚îÇ   ‚îú‚îÄ‚îÄ app.py                   # Flask API
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile               # Frontend React
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ configs/
    ‚îî‚îÄ‚îÄ telegram_config.json     # –ö–æ–Ω—Ñ–∏–≥ Telegram –±–æ—Ç–∞
```

## –ü–æ—Ä—Ç—ã

| –°–µ—Ä–≤–∏—Å | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π | –í–Ω–µ—à–Ω–∏–π | –ü—Ä–æ—Ç–æ–∫–æ–ª |
|--------|-----------|---------|----------|
| Nginx HTTPS | 443 | 3017 | HTTPS |
| Nginx HTTP | 80 | 3080 | HTTP (redirect) |
| Backend | 5001 | - | HTTPS (internal) |
| Frontend | 3000 | - | HTTP (internal) |

## –î–æ—Å—Ç—É–ø

- **Production**: `https://gigawin.unicorns-group.ru`
- **VPN**: `https://10.8.0.17:3017`

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞:

**–í Portainer:**
1. Stacks ‚Üí `gigawin2025`
2. –ù–∞–∂–º–∏—Ç–µ **"Update the stack"**
3. –í—ã–±–µ—Ä–∏—Ç–µ **"Re-pull image and redeploy"**
4. –ù–∞–∂–º–∏—Ç–µ **"Update"**

**–ò–ª–∏ —á–µ—Ä–µ–∑ Git (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Git repository):**
1. Push –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –í Portainer: **"Pull and redeploy"**

## Troubleshooting

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç—ã 3017 –∏ 3080 —Å–≤–æ–±–æ–¥–Ω—ã:
   ```bash
   netstat -tulpn | grep -E '3017|3080'
   ```

### 502 Bad Gateway
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –∏ frontend –∑–∞–ø—É—â–µ–Ω—ã
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ healthcheck:
   ```bash
   docker ps | grep gigawin
   ```

### CORS –æ—à–∏–±–∫–∏
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–æ–≥–∞—Ö backend:
```bash
docker logs gigawin-backend | grep CORS
```

### SSL –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤. –í –±—Ä–∞—É–∑–µ—Ä–µ:
1. –ù–∞–∂–º–∏—Ç–µ "Advanced"
2. "Proceed to site (unsafe)"

## –í–∞–∂–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps -a | grep gigawin

# –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose logs -f

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker restart gigawin-backend

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose down

# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ (—É–¥–∞–ª–µ–Ω–∏–µ volumes)
docker-compose down -v
docker-compose up -d --build
```

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `DEPLOYMENT.md`
- README –ø—Ä–æ–µ–∫—Ç–∞: `README.md`

## Checklist –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

- [ ] Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] Portainer –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –ü–æ—Ä—Ç—ã 3017 –∏ 3080 —Å–≤–æ–±–æ–¥–Ω—ã
- [ ] Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- [ ] VPN –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–¥–ª—è 10.8.0.17)
- [ ] –î–æ–º–µ–Ω gigawin.unicorns-group.ru –Ω–∞—Å—Ç—Ä–æ–µ–Ω

## –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è

‚úÖ –í—Å–µ 4 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞—é—Ç  
‚úÖ Frontend –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS  
‚úÖ Backend API –æ—Ç–≤–µ—á–∞–µ—Ç  
‚úÖ Healthcheck –ø—Ä–æ—Ö–æ–¥–∏—Ç  
‚úÖ Telegram bot –ø–æ–¥–∫–ª—é—á–µ–Ω  

**–ì–æ—Ç–æ–≤–æ! –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç! üöÄ**

